<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Loja Online</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        header {
            background: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        h1 {
            color: #667eea;
            text-align: center;
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 20px;
        }
        
        .controls select {
            padding: 10px 20px;
            border: 2px solid #667eea;
            border-radius: 25px;
            font-size: 1em;
            cursor: pointer;
            background: white;
            color: #667eea;
            font-weight: bold;
        }
        
        .cart-info {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 15px;
        }
        
        .cart-count {
            background: #667eea;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
        }
        
        .filters {
            background: white;
            padding: 15px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .filter-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .filter-btn {
            padding: 10px 20px;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        .filter-btn.active {
            background: #667eea;
            color: white;
        }
        
        .filter-btn:hover {
            transform: scale(1.05);
        }
        
        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }
        
        .product-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s, box-shadow 0.3s;
            position: relative;
        }
        
        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }
        
        .product-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 10px;
            margin-bottom: 15px;
        }
        
        .product-status {
            position: absolute;
            top: 25px;
            right: 25px;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.85em;
            font-weight: bold;
        }
        
        .status-disponivel {
            background: #28a745;
            color: white;
        }
        
        .status-esgotado {
            background: #dc3545;
            color: white;
        }
        
        .product-card h3 {
            color: #333;
            margin-bottom: 10px;
            font-size: 1.3em;
        }
        
        .product-card p {
            color: #666;
            margin-bottom: 15px;
            line-height: 1.5;
        }
        
        .session-badge {
            display: inline-block;
            background: #f0f0f0;
            padding: 5px 10px;
            border-radius: 10px;
            font-size: 0.85em;
            margin-bottom: 10px;
            color: #666;
        }
        
        .price {
            font-size: 1.5em;
            color: #667eea;
            font-weight: bold;
            margin: 15px 0;
        }
        
        .price-secondary {
            font-size: 0.9em;
            color: #999;
            margin-top: 5px;
        }
        
        .quantity-control {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 15px 0;
        }
        
        .quantity-control button {
            background: #667eea;
            color: white;
            border: none;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.2em;
            transition: background 0.3s;
        }
        
        .quantity-control button:hover {
            background: #764ba2;
        }
        
        .quantity-control input {
            width: 60px;
            text-align: center;
            border: 2px solid #667eea;
            border-radius: 8px;
            padding: 8px;
            font-size: 1em;
        }
        
        .add-to-cart {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            width: 100%;
            font-size: 1em;
            font-weight: bold;
            transition: transform 0.2s;
        }
        
        .add-to-cart:hover {
            transform: scale(1.05);
        }
        
        .add-to-cart:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        
        .checkout-section {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .cart-items {
            margin-bottom: 20px;
        }
        
        .cart-item {
            display: flex;
            justify-content: space-between;
            padding: 15px;
            border-bottom: 1px solid #eee;
            align-items: center;
        }
        
        .cart-item:last-child {
            border-bottom: none;
        }
        
        .item-details {
            flex: 1;
        }
        
        .item-name {
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }
        
        .item-price {
            color: #667eea;
        }
        
        .remove-item {
            background: #dc3545;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .remove-item:hover {
            background: #c82333;
        }
        
        .total {
            font-size: 1.8em;
            font-weight: bold;
            color: #667eea;
            text-align: right;
            margin: 20px 0;
            padding-top: 20px;
            border-top: 2px solid #667eea;
        }
        
        .whatsapp-form {
            margin-top: 25px;
        }
        
        .whatsapp-form input,
        .whatsapp-form textarea {
            width: 100%;
            padding: 12px;
            margin-bottom: 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
        }
        
        .whatsapp-form input:focus,
        .whatsapp-form textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .send-whatsapp {
            background: #25D366;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            cursor: pointer;
            width: 100%;
            font-size: 1.1em;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: transform 0.2s;
        }
        
        .send-whatsapp:hover {
            transform: scale(1.05);
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: white;
            font-size: 1.5em;
        }
        
        .empty-cart {
            text-align: center;
            padding: 40px;
            color: #666;
            font-size: 1.2em;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üõçÔ∏è Padaria Online</h1>
            
            <div class="controls">
                <select id="languageSelect" onchange="changeLanguage()">
					<option value="es">üáµüáæ Guarani</option>
                    <option value="es">üáµüáæ Espa√±ol</option>
					<option value="pt-BR">üáßüá∑ Portugu√™s</option>
                    <option value="en">üá∫üá∏ English</option>
                </select>
                
                <select id="currencySelect" onchange="changeCurrency()">
                    <option value="PYG">‚Ç≤ Guarani</option>
                    <option value="USD">$ D√≥lar</option>
					<option value="BRL">R$ Real</option>
                </select>
            </div>
            
            <div class="cart-info">
                <div id="cartLabel">Seu carrinho</div>
                <div class="cart-count"><span id="cartCount">0</span> <span id="itemsLabel">itens</span></div>
            </div>
        </header>
        
        <div class="filters">
            <div class="filter-buttons">
                <button class="filter-btn active" onclick="filterBySession('all')" id="filterAll">Todos</button>
                <button class="filter-btn" onclick="filterBySession('Principal')" id="filterPrincipal">Principal</button>
                <button class="filter-btn" onclick="filterBySession('Sin gluten')" id="filterGluten">Sin gluten</button>
            </div>
        </div>
        
        <div id="productsContainer" class="products-grid">
            <div class="loading">Carregando produtos...</div>
        </div>
        
        <div id="checkoutSection" class="checkout-section" style="display: none;">
            <h2 style="color: #667eea; margin-bottom: 20px;" id="cartTitle">üõí Seu Carrinho</h2>
            <div id="cartItems" class="cart-items"></div>
            <div id="totalPrice" class="total"></div>
            
            <div class="whatsapp-form">
                <h3 style="color: #667eea; margin-bottom: 15px;" id="whatsappTitle">üì± Finalizar pelo WhatsApp</h3>
                <input type="text" id="customerName" placeholder="Seu nome" required>
                <input type="text" id="customerAddress" placeholder="Endere√ßo de entrega" required>
                <textarea id="customerNotes" placeholder="Observa√ß√µes (opcional)" rows="3"></textarea>
                <button class="send-whatsapp" onclick="sendToWhatsApp()">
                    <span style="font-size: 1.5em;">üì≤</span>
                    <span id="sendButtonText">Enviar Pedido pelo WhatsApp</span>
                </button>
            </div>
        </div>
    </div>

    <script>
        const SHEET_ID = '1F8tGGQwwGp9mNcLOq5BQ6U5ydMG1ZvrTAFHND5L_7y8';
        
        let allProducts = [];
        let cart = JSON.parse(localStorage.getItem('cart')) || [];
        let currentLanguage = localStorage.getItem('language') || 'pt-BR';
        let currentCurrency = localStorage.getItem('currency') || 'BRL';
        let currentFilter = 'all';
        let translations = {};
        let companyName = 'Loja Online';
        let whatsappNumber = '5511999999999';
        let userLocation = JSON.parse(localStorage.getItem('userLocation')) || null;
        
        const texts = {
            'pt-BR': {
                cartLabel: 'Seu carrinho',
                itemsLabel: 'itens',
                cartTitle: 'üõí Seu Carrinho',
                whatsappTitle: 'üì± Finalizar pelo WhatsApp',
                sendButton: 'Enviar Pedido pelo WhatsApp',
                namePlaceholder: 'Seu nome',
                addressPlaceholder: 'Endere√ßo de entrega',
                notesPlaceholder: 'Observa√ß√µes (opcional)',
                remove: 'Remover',
                total: 'Total',
                addToCart: 'Adicionar ao Carrinho',
                outOfStock: 'Esgotado',
                filterAll: 'Todos',
                alertName: 'Por favor, preencha seu nome e endere√ßo!',
                alertCart: 'Seu carrinho est√° vazio!'
            },
            'es': {
                cartLabel: 'Tu carrito',
                itemsLabel: 'art√≠culos',
                cartTitle: 'üõí Tu Carrito',
                whatsappTitle: 'üì± Finalizar por WhatsApp',
                sendButton: 'Enviar Pedido por WhatsApp',
                namePlaceholder: 'Tu nombre',
                addressPlaceholder: 'Direcci√≥n de entrega',
                notesPlaceholder: 'Observaciones (opcional)',
                remove: 'Eliminar',
                total: 'Total',
                addToCart: 'Agregar al Carrito',
                outOfStock: 'Agotado',
                filterAll: 'Todos',
                alertName: '¬°Por favor, completa tu nombre y direcci√≥n!',
                alertCart: '¬°Tu carrito est√° vac√≠o!'
            },
            'en': {
                cartLabel: 'Your cart',
                itemsLabel: 'items',
                cartTitle: 'üõí Your Cart',
                whatsappTitle: 'üì± Checkout via WhatsApp',
                sendButton: 'Send Order via WhatsApp',
                namePlaceholder: 'Your name',
                addressPlaceholder: 'Delivery address',
                notesPlaceholder: 'Notes (optional)',
                remove: 'Remove',
                total: 'Total',
                addToCart: 'Add to Cart',
                outOfStock: 'Out of Stock',
                filterAll: 'All',
                alertName: 'Please fill in your name and address!',
                alertCart: 'Your cart is empty!'
            }
        };
        
        const currencySymbols = {
            'BRL': 'R$',
            'PYG': '‚Ç≤',
            'USD': '$'
        };
        
        window.addEventListener('load', () => {
            document.getElementById('languageSelect').value = currentLanguage;
            document.getElementById('currencySelect').value = currentCurrency;
            
            const savedName = localStorage.getItem('customerName');
            const savedAddress = localStorage.getItem('customerAddress');
            const savedNotes = localStorage.getItem('customerNotes');
            
            if (savedName) document.getElementById('customerName').value = savedName;
            if (savedAddress) document.getElementById('customerAddress').value = savedAddress;
            if (savedNotes) document.getElementById('customerNotes').value = savedNotes;
            
            document.getElementById('customerName').addEventListener('input', (e) => {
                localStorage.setItem('customerName', e.target.value);
            });
            document.getElementById('customerAddress').addEventListener('input', (e) => {
                localStorage.setItem('customerAddress', e.target.value);
            });
            document.getElementById('customerNotes').addEventListener('input', (e) => {
                localStorage.setItem('customerNotes', e.target.value);
            });
            
            updateUITexts();
            
            // Capturar localiza√ß√£o
            getLocation();
        });
        
        function updateUITexts() {
            const t = texts[currentLanguage];
            document.getElementById('cartLabel').textContent = t.cartLabel;
            document.getElementById('itemsLabel').textContent = t.itemsLabel;
            document.getElementById('cartTitle').textContent = t.cartTitle;
            document.getElementById('whatsappTitle').textContent = t.whatsappTitle;
            document.getElementById('sendButtonText').textContent = t.sendButton;
            document.getElementById('customerName').placeholder = t.namePlaceholder;
            document.getElementById('customerAddress').placeholder = t.addressPlaceholder;
            document.getElementById('customerNotes').placeholder = t.notesPlaceholder;
            document.getElementById('filterAll').textContent = t.filterAll;
        }
        
        function changeLanguage() {
            currentLanguage = document.getElementById('languageSelect').value;
            localStorage.setItem('language', currentLanguage);
            updateUITexts();
            displayProducts();
            updateCart();
        }
        
        function changeCurrency() {
            currentCurrency = document.getElementById('currencySelect').value;
            localStorage.setItem('currency', currentCurrency);
            displayProducts();
            updateCart();
        }
        
        function filterBySession(session) {
            currentFilter = session;
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            displayProducts();
        }
        
        async function loadProducts() {
            try {
                // Carregar Config primeiro
                await loadConfig();
                
                // Carregar Index
                const indexUrl = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&sheet=Index`;
                const indexResponse = await fetch(indexUrl);
                const indexText = await indexResponse.text();
                const indexJson = JSON.parse(indexText.substr(47).slice(0, -2));
                
                const indexRows = indexJson.table.rows.slice(1);
                
                allProducts = indexRows.map(row => {
                    // Verificar se a linha tem dados
                    if (!row.c || !row.c[0] || !row.c[1]) return null;
                    
                    const idSessao = row.c[0]?.v || '';
                    const idProduto = row.c[1]?.v || '';
                    const nomeProd = row.c[2]?.v || '';
                    const descricao = row.c[3]?.v || '';
                    const urlImagem = row.c[4]?.v || '';
                    
                    // Pre√ßos podem estar como texto com "Gs." - remover e converter
                    const precoGuaraniRaw = row.c[5]?.v || '0';
                    const precoRealRaw = row.c[6]?.v || '0';
                    const precoDolarRaw = row.c[7]?.v || '0';
                    
                    const precoGuarani = parseFloat(String(precoGuaraniRaw).replace(/[^\d.,]/g, '').replace(',', '.')) || 0;
                    const precoReal = parseFloat(String(precoRealRaw).replace(/[^\d.,]/g, '').replace(',', '.')) || 0;
                    const precoDolar = parseFloat(String(precoDolarRaw).replace(/[^\d.,]/g, '').replace(',', '.')) || 0;
                    
                    const status = row.c[8]?.v || 'Disponivel';
                    
                    return {
                        id: idProduto,
                        session: idSessao,
                        name: nomeProd,
                        description: descricao,
                        image: urlImagem,
                        prices: {
                            PYG: precoGuarani,
                            BRL: precoReal,
                            USD: precoDolar
                        },
                        status: status
                    };
                }).filter(p => p.name);
                
                // Carregar tradu√ß√µes das abas de idioma
                await loadTranslations();
                
                displayProducts();
                updateCart();
            } catch (error) {
                console.error('Erro:', error);
                document.getElementById('productsContainer').innerHTML = 
                    '<div class="loading">Erro ao carregar produtos. Verifique a planilha.</div>';
            }
        }
        
        async function loadTranslations() {
            try {
                const langs = ['es', 'pt-BR', 'en'];
                for (const lang of langs) {
                    const sheetName = lang === 'pt-BR' ? 'pt-BR' : lang;
                    const url = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&sheet=${sheetName}`;
                    const response = await fetch(url);
                    const text = await response.text();
                    const json = JSON.parse(text.substr(47).slice(0, -2));
                    
                    translations[lang] = {};
                    json.table.rows.slice(1).forEach(row => {
                        const idSessao = row.c[0]?.v || '';
                        const idProduto = row.c[1]?.v || '';
                        const nome = row.c[2]?.v || '';
                        const desc = row.c[3]?.v || '';
                        const status = row.c[4]?.v || '';
                        
                        const key = `${idSessao}_${idProduto}`;
                        translations[lang][key] = {
                            name: nome,
                            description: desc,
                            status: status
                        };
                    });
                }
            } catch (error) {
                console.error('Erro ao carregar tradu√ß√µes:', error);
            }
        }
        
        async function loadConfig() {
            try {
                const configUrl = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&sheet=Config`;
                const response = await fetch(configUrl);
                const text = await response.text();
                const json = JSON.parse(text.substr(47).slice(0, -2));
                
                const rows = json.table.rows;
                
                // Linha 1: Nome da Empresa (C1)
                companyName = rows[0]?.c[2]?.v || 'Loja Online';
                
                // Linha 2: WhatsApp (C2)
                whatsappNumber = rows[1]?.c[2]?.v || '5511999999999';
                
                // Atualizar o t√≠tulo
                document.querySelector('h1').textContent = `üõçÔ∏è ${companyName}`;
                
            } catch (error) {
                console.error('Erro ao carregar config:', error);
            }
        }
        
        function getTranslatedProduct(product) {
            const key = `${product.session}_${product.id}`;
            const translation = translations[currentLanguage]?.[key];
            
            if (translation) {
                return {
                    ...product,
                    name: translation.name || product.name,
                    description: translation.description || product.description,
                    status: translation.status || product.status
                };
            }
            return product;
        }
        
        function displayProducts() {
            const container = document.getElementById('productsContainer');
            
            let filtered = allProducts;
            if (currentFilter !== 'all') {
                filtered = allProducts.filter(p => p.session === currentFilter);
            }
            
            const t = texts[currentLanguage];
            
            container.innerHTML = filtered.map(product => {
                const translatedProduct = getTranslatedProduct(product);
                const price = translatedProduct.prices[currentCurrency];
                const symbol = currencySymbols[currentCurrency];
                const isAvailable = translatedProduct.status.toLowerCase().includes('dispon');
                
                return `
                <div class="product-card">
                    <div class="product-status status-${isAvailable ? 'disponivel' : 'esgotado'}">
                        ${translatedProduct.status}
                    </div>
                    ${translatedProduct.image ? `<img src="${translatedProduct.image}" class="product-image" alt="${translatedProduct.name}">` : ''}
                    <div class="session-badge">${translatedProduct.session}</div>
                    <h3>${translatedProduct.name}</h3>
                    <p>${translatedProduct.description}</p>
                    <div class="price">
                        ${symbol} ${price.toFixed(2)}
                    </div>
                    ${isAvailable ? `
                    <div class="quantity-control">
                        <button onclick="changeQuantity('${product.id}', -1)">-</button>
                        <input type="number" id="qty-${product.id}" value="1" min="1" readonly>
                        <button onclick="changeQuantity('${product.id}', 1)">+</button>
                    </div>
                    <button class="add-to-cart" onclick="addToCart('${product.id}')">
                        ${t.addToCart}
                    </button>
                    ` : `
                    <button class="add-to-cart" disabled>
                        ${t.outOfStock}
                    </button>
                    `}
                </div>
            `;
            }).join('');
        }
        
        function changeQuantity(productId, change) {
            const input = document.getElementById(`qty-${productId}`);
            const newValue = Math.max(1, parseInt(input.value) + change);
            input.value = newValue;
        }
        
        function addToCart(productId) {
            const product = allProducts.find(p => p.id === productId);
            const quantity = parseInt(document.getElementById(`qty-${productId}`).value);
            
            const existingItem = cart.find(item => item.id === productId);
            
            if (existingItem) {
                existingItem.quantity += quantity;
            } else {
                cart.push({
                    ...product,
                    quantity: quantity
                });
            }
            
            localStorage.setItem('cart', JSON.stringify(cart));
            updateCart();
            
            document.getElementById(`qty-${productId}`).value = 1;
        }
        
        function removeFromCart(productId) {
            cart = cart.filter(item => item.id !== productId);
            localStorage.setItem('cart', JSON.stringify(cart));
            updateCart();
        }
        
        function updateCart() {
            const cartCount = document.getElementById('cartCount');
            const cartItems = document.getElementById('cartItems');
            const checkoutSection = document.getElementById('checkoutSection');
            const totalPrice = document.getElementById('totalPrice');
            
            const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
            cartCount.textContent = totalItems;
            
            if (cart.length === 0) {
                checkoutSection.style.display = 'none';
                return;
            }
            
            checkoutSection.style.display = 'block';
            
            const t = texts[currentLanguage];
            const symbol = currencySymbols[currentCurrency];
            
            cartItems.innerHTML = cart.map(item => {
                const translatedItem = getTranslatedProduct(item);
                const price = item.prices[currentCurrency];
                const subtotal = quantity * price;
                
                return `
                <div class="cart-item">
                    <div class="item-details">
                        <div class="item-name">${translatedItem.name}</div>
                        <div class="item-price">
                            ${item.quantity}x ${symbol} ${price.toFixed(2)} = 
                            ${symbol} ${subtotal.toFixed(2)}
                        </div>
                    </div>
                    <button class="remove-item" onclick="removeFromCart('${item.id}')">
                        ${t.remove}
                    </button>
                </div>
            `;
            }).join('');
            
            const total = cart.reduce((sum, item) => sum + (item.quantity * item.prices[currentCurrency]), 0);
            totalPrice.innerHTML = `${t.total}: ${symbol} ${total.toFixed(2)}`;
        }
        
        function sendToWhatsApp() {
            const name = document.getElementById('customerName').value;
            const address = document.getElementById('customerAddress').value;
            const notes = document.getElementById('customerNotes').value;
            
            const t = texts[currentLanguage];
            
            if (!name || !address) {
                alert(t.alertName);
                return;
            }
            
            if (cart.length === 0) {
                alert(t.alertCart);
                return;
            }
            
            const symbol = currencySymbols[currentCurrency];
            const total = cart.reduce((sum, item) => sum + (item.quantity * item.prices[currentCurrency]), 0);
            
            let message = `üõçÔ∏è *NOVO PEDIDO - ${companyName}*\n\n`;
            message += `üë§ *Cliente:* ${name}\n`;
            message += `üìç *Endere√ßo:* ${address}\n`;
            
            // Adicionar localiza√ß√£o GPS se dispon√≠vel
            if (userLocation) {
                message += `üìå *Localiza√ß√£o GPS:* https://www.google.com/maps?q=${userLocation.latitude},${userLocation.longitude}\n`;
            }
            
            message += `üåê *Idioma:* ${currentLanguage}\n`;
            message += `üí∞ *Moeda:* ${currentCurrency}\n\n`;
            message += `üì¶ *Itens do Pedido:*\n\n`;
            
            cart.forEach(item => {
                const translatedItem = getTranslatedProduct(item);
                const price = item.prices[currentCurrency];
                message += `‚Ä¢ ${item.quantity}x ${translatedItem.name}\n`;
                message += `  ${symbol} ${price.toFixed(2)} cada = ${symbol} ${(item.quantity * price).toFixed(2)}\n\n`;
            });
            
            message += `üí∞ *TOTAL: ${symbol} ${total.toFixed(2)}*\n\n`;
            
            if (notes) {
                message += `üìù *Observa√ß√µes:* ${notes}\n`;
            }
            
            const encodedMessage = encodeURIComponent(message);
            const whatsappURL = `https://wa.me/${whatsappNumber}?text=${encodedMessage}`;
            
            window.open(whatsappURL, '_blank');
        }
        
        function getLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        userLocation = {
                            latitude: position.coords.latitude,
                            longitude: position.coords.longitude,
                            timestamp: new Date().toISOString()
                        };
                        localStorage.setItem('userLocation', JSON.stringify(userLocation));
                        console.log('‚úÖ Localiza√ß√£o capturada:', userLocation);
                    },
                    (error) => {
                        console.warn('‚ö†Ô∏è N√£o foi poss√≠vel obter localiza√ß√£o:', error.message);
                        // N√£o bloqueia o uso, apenas n√£o ter√° GPS
                    },
                    {
                        enableHighAccuracy: true,
                        timeout: 5000,
                        maximumAge: 300000 // 5 minutos
                    }
                );
            } else {
                console.warn('‚ö†Ô∏è Geolocaliza√ß√£o n√£o suportada neste navegador');
            }
        }
        
        loadProducts();
    </script>
</body>
</html>